{% load static %}
<!doctype html>
<html class="no-js " lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<meta name="description" content="Responsive Bootstrap 4 and web Application ui kit.">

<title>Data Electronics | New Purchase</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<!-- Favicon-->
<link rel="stylesheet" href="{% static 'assets/plugins/bootstrap/css/bootstrap.min.css' %}">
<!-- Bootstrap Material Datetime Picker Css -->
<link href="{% static 'assets/plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css' %}" rel="stylesheet" />
<!-- Bootstrap Select Css -->
<!-- <link href="{% static 'assets/plugins/bootstrap-select/css/bootstrap-select.css' %}" rel="stylesheet" /> -->
<!-- Custom Css -->
<link  rel="stylesheet" href="{% static 'assets/css/style.min.css' %}">

</head>

<body class="theme-blush">

<!-- Page Loader -->
<div class="page-loader-wrapper">
    <div class="loader">
        <div class="m-t-30"><img class="zmdi-hc-spin" src="assets/images/loader.svg" width="48" height="48" alt="Aero"></div>
        <p>Please wait...</p>
    </div>
</div>

<!-- Overlay For Sidebars -->
<div class="overlay"></div>
  <div class="navbar-right">
        <ul class="navbar-nav">

            <li class="dropdown">
                <a href="javascript:void(0);" class="dropdown-toggle" title="App" data-toggle="dropdown" role="button"><i class="zmdi zmdi-apps"></i></a>
                <ul class="dropdown-menu slideUp2">
                    <li class="header">App Shortcuts</li>
                    <li class="body">
                        <ul class="menu app_sortcut list-unstyled">
                            <li>
                                <a href="image-gallery.html">
                                    <div class="icon-circle mb-2 bg-blue"><i class="zmdi zmdi-account-calendar"></i></div>
                                    <p class="mb-0">Mark Attendence</p>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0);">
                                    <div class="icon-circle mb-2 bg-amber"><i class="zmdi zmdi-assignment-o"></i></div>
                                    <p class="mb-0">Sales History</p>
                                </a>
                            </li>
                            <li>
                                <a href="events.html">
                                    <div class="icon-circle mb-2 bg-green"><i class="zmdi zmdi-storage"></i></div>
                                    <p class="mb-0">Available Stock</p>
                                </a>
                            </li>
                            <li>
                                <a href="contact.html">
                                    <div class="icon-circle mb-2 bg-purple"><i class="zmdi zmdi-collection-plus"></i></div>
                                    <p class="mb-0">New Incoming Stock</p>
                                </a>
                            </li>

                        </ul>
                    </li>
                </ul>
            </li>



            <li><a href="javascript:void(0);" class="js-right-sidebar" title="Setting"><i class="zmdi zmdi-settings zmdi-hc-spin"></i></a></li>
            <li><a href="{% url 'login' %}" class="mega-menu" title="Sign Out"><i class="zmdi zmdi-power"></i></a></li>
        </ul>
    </div>

    <!-- Left Sidebar -->
    <aside id="leftsidebar" class="sidebar">
        <div class="navbar-brand">
            <button class="btn-menu ls-toggle-btn" type="button"><i class="zmdi zmdi-menu"></i></button>
            <a href="{% url 'dashboard' %}"><img src="{% static 'assets/images/logo.svg'%}" width="25" alt="Aero"><span class="m-l-10">Data Electronics</span></a>
        </div>
        <div class="menu">
            <ul class="list">
                <li>
                    <div class="user-info">
                        <a class="image" href="profile.html"><img src="{% static 'img/admin.png' %}" alt="User"></a>
                        <div class="detail">
                            <h4>{{ user.username }}</h4>
                            <small>Super Admin</small>
                        </div>
                    </div>
                </li>
                <li class="active open"><a href="{% url 'dashboard' %}"><i class="zmdi zmdi-home"></i><span>Dashboard</span></a></li>
                <li><a href="{% url 'new-sale'%}"><i class="zmdi zmdi-edit"></i><span>New Invoice</span></a></li>
                <li><a href="javascript:void(0);" class="menu-toggle"><i class="zmdi zmdi-assignment-o"></i><span>Sales</span></a>
                    <ul class="ml-menu">
                        <li><a href="{% url 'new-sale'%}">New Invoice</a></li>
                        <li><a href="{% url 'sales-list'%}">Sales History</a></li>


                    </ul>
                </li>
                <li> <a href="javascript:void(0);" class="menu-toggle"><i class="zmdi zmdi-inbox"></i><span>Purchases</span></a>
                    <ul class="ml-menu">
                        <li><a href="{% url 'purchases-list'%}">Purchases History</a></li>
                        <li><a href="{% url 'select-supplier'%}">New Incoming Stock</a></li>

                    </ul>
                </li>
                <li> <a href="javascript:void(0);" class="menu-toggle"><i class="zmdi zmdi-storage"></i><span>Inventory</span></a>
                    <ul class="ml-menu">
                        <li><a href="{% url 'inventory' %}">Available Stock</a></li>
                        <li><a href="{% url 'new-stock' %}">Add New Stock Item</a></li>

                    </ul>
                </li>
                <li> <a href="javascript:void(0);" class="menu-toggle"><i class="zmdi zmdi-truck"></i><span>Suppliers</span></a>
                    <ul class="ml-menu">
                        <li><a href="{% url 'suppliers-list'%}">Current Suppliers</a></li>
                        <li><a href="{% url 'new-supplier'%}">Add New Supplier</a></li>

                    </ul>
                </li>
                <li><a href="javascript:void(0);" class="menu-toggle"><i class="zmdi zmdi-accounts"></i><span>Employees</span></a>
                    <ul class="ml-menu">
                        <li><a href="ec-dashboard.html">Mark Attendence</a></li>
                        <li><a href="{% url 'employees-list'%}">Employee Details </a></li>
                        <li><a href="ec-product-List.html">Pay Sheet</a></li>
                        <li><a href="{% url 'new-employee'%}">New Employee</a></li>
                    </ul>
                </li>
                <li><a href="javascript:void(0);" class="menu-toggle"><i class="zmdi zmdi-compass"></i><span>Support</span></a>
                    <ul class="ml-menu">
                        <li><a href="ui_kit.html">Instructions</a></li>
                        <li><a href="alerts.html">About</a></li>

                    </ul>
                </li>



            </ul>
        </div>
    </aside>

    <!-- Right Sidebar -->
    <aside id="rightsidebar" class="right-sidebar">
        <ul class="nav nav-tabs sm">
            <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#setting"><i class="zmdi zmdi-settings zmdi-hc-spin"></i></a></li>

        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="setting">
                <div class="slim_scroll">
                    <div class="card">
                        <h6>Theme Option</h6>
                        <div class="light_dark">
                            <div class="radio">
                                <input type="radio" name="radio1" id="lighttheme" value="light" checked="">
                                <label for="lighttheme">Light Mode</label>
                            </div>
                            <div class="radio mb-0">
                                <input type="radio" name="radio1" id="darktheme" value="dark">
                                <label for="darktheme">Dark Mode</label>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h6>Color Skins</h6>
                        <ul class="choose-skin list-unstyled">
                            <li data-theme="purple"><div class="purple"></div></li>
                            <li data-theme="blue" ><div class="blue"></div></li>
                            <li data-theme="cyan" ><div class="cyan"></div></li>
                            <li data-theme="green"><div class="green"></div></li>
                            <li data-theme="orange"class="active"><div class="orange"></div></li>
                            <li data-theme="blush" ><div class="blush"></div></li>
                        </ul>
                    </div>
                    <div class="card">
                        <h6>General Settings</h6>
                        <ul class="setting-list list-unstyled">
                            <li>
                                <div class="checkbox rtl_support">
                                    <input id="checkbox1" type="checkbox" value="rtl_view">
                                    <label for="checkbox1">RTL Version</label>
                                </div>
                            </li>
                            <li>
                                <div class="checkbox ms_bar">
                                    <input id="checkbox2" type="checkbox" value="mini_active">
                                    <label for="checkbox2">Mini Sidebar</label>
                                </div>
                            </li>

                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </aside>


    <section class="content" style="text-align:center;border-style: hidden;background-color:white;border-style: hidden;">
        <div class="hidden">
          {% if messages %}
              {% for message in messages %}
              <div class="alert alert-success alert-dismissible fade show" role="alert" align="center">
                <strong>{{ message }}!</strong>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                  </button>
                </div>

              {% endfor %}
          {% endif %}
        </div>
      </section>

<section class="content">
    <div class="body_scroll">
        <div class="block-header">
            <div class="row">
                <div class="col-lg-7 col-md-6 col-sm-12">
                    <h2>New Purchase</h2>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html"><i class="zmdi zmdi-home"></i> Data Electronics</a></li>
                        <li class="breadcrumb-item"><a href="javascript:void(0);">New Purchase</a></li>
                        <li class="breadcrumb-item active">Product Details</li>
                    </ul>
                </div>
                <div class="col-lg-5 col-md-6 col-sm-12">
                    <button class="btn btn-primary btn-icon float-right right_icon_toggle_btn" type="button"><i class="zmdi zmdi-arrow-right"></i></button>
                </div>
            </div>
        </div>

        <div class="container-fluid">




            <!-- Select -->
            <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card">
                        <div class="header">
                            <h2> <strong>Product Details</strong></h2>

                        </div>
                        <div class="body">
                            <div class="row clearfix">
                              <div class="col-lg-12 col-md-12 col-sm-12">
                              <form method="post" class="panel panel-default">

                                  {% csrf_token %}
                                  {{ formset.management_form }}


                                      <div id="stockitem">
                                          <div class="panel-body">
                                          {% for form in formset %}
                                          <br>
                                              <div class="row form-row">
                                                  <div class="col-sm-6">
                                                      {{ form.stock.errors }}
                                                      <label class="panel-body-text">Stock</label>
                                                      {{ form.stock }}
                                                  </div>
                                                  <div class="form-group col-md-2">
                                                      <label class="panel-body-text">Price per item</label>
                                                      {{ form.perprice }}
                                                  </div>
                                                  <div class="form-group col-md-2">
                                                      {{ form.quantity.errors }}
                                                      <label class="panel-body-text">Quantity</label>
                                                      {{ form.quantity }}
                                                  </div>
                                                  <div class="form-group col-md-1">
                                                      <label class="panel-body-text">Price</label>
                                                      <input type="text" class="textinput form-control totalprice" value="1" disabled required>
                                                  </div>
                                                  <div class="form-group col-md-1">
                                                      <a href="#" class="remove-form-row"><i class="zmdi zmdi-close-circle-o "></i></a>


                                                  </div>
                                              </div>
                                              <br>

                                          {% endfor %}
                                              <div style="text-align: right;">
                                                  <a href="#" class="add-form-row">+ Add More</a>
                                              </div>
                                          </div>
                                      </div>


                                  <br>

                                  <div class="align-middle">
                                      <button type="submit" class="btn btn-raised btn-primary btn-round waves-effect">Add to Purchases</button>
                                      <a href="{% url 'select-supplier' %}" class="btn btn-raised btn-warning btn-round waves-effect">Go Back</a>
                                      <a href="" class="btn btn-raised btn-danger btn-round waves-effect">Cancel</a>
                                  </div>

                              </form>

                            </div>
                          </div>
                        </div>
                    </div>

                </div>
            </div>


        </div>
    </div>
</section>

<!-- Custom JS to add and remove item forms -->
<script type="text/javascript" src="{% static 'js/jquery-3.2.1.slim.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/dialogbox.js' %}"></script>
<script type="text/javascript">

    //creates custom alert object
    var custom_alert = new custom_alert();

    function updateElementIndex(el, prefix, ndx) {
        var id_regex = new RegExp('(' + prefix + '-\\d+)');
        var replacement = prefix + '-' + ndx;
        if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex, replacement));
        if (el.id) el.id = el.id.replace(id_regex, replacement);
        if (el.name) el.name = el.name.replace(id_regex, replacement);
    }

    //stores the total no of item forms
    var total = 1;

    function cloneMore(selector, prefix) {
        var newElement = $(selector).clone(true);
        //var total = $('#id_' + prefix + '-TOTAL_FORMS').val();
        newElement.find(':input:not([type=button]):not([type=submit]):not([type=reset])').each(function() {
            var name = $(this).attr('name')
            if(name) {
                name = name.replace('-' + (total-1) + '-', '-' + total + '-');
                var id = 'id_' + name;
                $(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
            }
        });
        newElement.find('label').each(function() {
            var forValue = $(this).attr('for');
            if (forValue) {
            forValue = forValue.replace('-' + (total-1) + '-', '-' + total + '-');
            $(this).attr({'for': forValue});
            }
        });
        total++;
        $('#id_' + prefix + '-TOTAL_FORMS').val(total);
        $(selector).after(newElement);
        return false;
    }

    function deleteForm(prefix, btn) {
        //var total = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
        if (total > 1){
            btn.closest('.form-row').remove();
            var forms = $('.form-row');
            $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
            for (var i=0, formCount=forms.length; i<formCount; i++) {
                $(forms.get(i)).find(':input').each(function() {
                    updateElementIndex(this, prefix, i);
                });
            }
            total--;
        } else {
            custom_alert.render("Field cannot be deleted");
        }
        return false;
    }

    $(document).on('click', '.add-form-row', function(e){
        e.preventDefault();
        cloneMore('.form-row:last', 'form');
        return false;
    });

    $(document).on('click', '.remove-form-row', function(e){
        e.preventDefault();
        deleteForm('form', $(this));
        return false;
    });


    //updates the total price by multiplying 'price per item' and 'quantity'
    $(document).on('change', '.setprice', function(e){
        e.preventDefault();
        //gets the values
        var element = $(this);
        var quantity = element.parents('.form-row').find('.quantity').val();
        var perprice = element.parents('.form-row').find('.price').val();
        //calculates the total
        var tprice = quantity * perprice;
        //sets it to field
        element.parents('.form-row').find('.totalprice').val(tprice);
        return false;
    });

</script>

<!-- Jquery Core Js -->
<script src="{% static 'assets/bundles/libscripts.bundle.js' %}"></script> <!-- Lib Scripts Plugin Js -->
<script src="{% static 'assets/bundles/vendorscripts.bundle.js' %}"></script> <!-- Lib Scripts Plugin Js -->

<script src="{% static 'assets/plugins/momentjs/moment.js' %}"></script> <!-- Moment Plugin Js -->
<!-- Bootstrap Material Datetime Picker Plugin Js -->
<script src="{% static 'assets/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js' %}"></script>

<script src="{% static 'assets/bundles/mainscripts.bundle.js' %}"></script><!-- Custom Js -->
<script src="{% static 'assets/js/pages/forms/basic-form-elements.js' %}"></script>
</body>
</html>
